from __future__ import annotations

from collections.abc import Mapping

ThemeTokens = dict[str, str]

_BASELINE_TOKENS: ThemeTokens = {
    "bg0": "#0f1319",
    "bg1": "#151a21",
    "bg2": "#1a2028",
    "text": "#e9eef5",
    "textMuted": "#98a6b8",
    "primary": "#d7883d",
    "primaryHover": "#e0964f",
    "primaryActive": "#bf7733",
    "border": "#2a3442",
    "success": "#4caf77",
    "warn": "#d4a14e",
    "danger": "#cc5f5f",
    "selectionBg": "#3a4c62",
    "selectionText": "#ffffff",
    "focusRing": "#e0a15e",
    "tableHeaderBg": "#1c242e",
    "tableRowAlt": "#121820",
    "shadowColor": "rgba(0, 0, 0, 0.35)",
}

_THEME_TOKENS: dict[str, ThemeTokens] = {
    "shroudkeeper": {
        **_BASELINE_TOKENS,
        "bg0": "#0a0b11",
        "bg1": "#111320",
        "bg2": "#171a2a",
        "text": "#f4f6ff",
        "textMuted": "#a9afc9",
        "primary": "#ff2d55",
        "primaryHover": "#ff4a73",
        "primaryActive": "#df1d46",
        "border": "#2a2f49",
        "success": "#41d39b",
        "warn": "#ffd34d",
        "danger": "#ff496d",
        "selectionBg": "#2c1a2a",
        "selectionText": "#ffffff",
        "focusRing": "#ff6d8b",
        "tableHeaderBg": "#161a2c",
        "tableRowAlt": "#0d1020",
        "shadowColor": "rgba(0, 0, 0, 0.5)",
    },
    "dark_neon_orange": {
        **_BASELINE_TOKENS,
        "bg0": "#090b10",
        "bg1": "#111621",
        "bg2": "#191f2d",
        "text": "#f2f5ff",
        "textMuted": "#a7b2c7",
        "primary": "#ff8f1f",
        "primaryHover": "#ffab4d",
        "primaryActive": "#e2760e",
        "border": "#2a3346",
        "success": "#3fd69a",
        "warn": "#ffd34f",
        "danger": "#ff5f76",
        "selectionBg": "#342413",
        "selectionText": "#ffffff",
        "focusRing": "#ffba66",
        "tableHeaderBg": "#171d2b",
        "tableRowAlt": "#0d1320",
        "shadowColor": "rgba(0, 0, 0, 0.5)",
    },
    "dark_neon_green": {
        **_BASELINE_TOKENS,
        "bg0": "#070d0b",
        "bg1": "#0f1816",
        "bg2": "#162321",
        "text": "#effff6",
        "textMuted": "#9dc1b3",
        "primary": "#1dff8a",
        "primaryHover": "#4dff9f",
        "primaryActive": "#0fdc73",
        "border": "#25433b",
        "success": "#18dc7c",
        "warn": "#f2d456",
        "danger": "#ff6076",
        "selectionBg": "#123328",
        "selectionText": "#ffffff",
        "focusRing": "#74ffbb",
        "tableHeaderBg": "#13221f",
        "tableRowAlt": "#0b1513",
        "shadowColor": "rgba(0, 0, 0, 0.5)",
    },
    "dark_neon_blue": {
        **_BASELINE_TOKENS,
        "bg0": "#060a12",
        "bg1": "#0e1424",
        "bg2": "#15203a",
        "text": "#eef5ff",
        "textMuted": "#9eb0cf",
        "primary": "#2d8cff",
        "primaryHover": "#55a4ff",
        "primaryActive": "#1c73df",
        "border": "#2a3f63",
        "success": "#3dd0a6",
        "warn": "#f4cd59",
        "danger": "#ff6178",
        "selectionBg": "#142a4a",
        "selectionText": "#ffffff",
        "focusRing": "#7ab8ff",
        "tableHeaderBg": "#12203a",
        "tableRowAlt": "#0b1528",
        "shadowColor": "rgba(0, 0, 0, 0.5)",
    },
    "dark_neon_yellow": {
        **_BASELINE_TOKENS,
        "bg0": "#101008",
        "bg1": "#19190f",
        "bg2": "#232215",
        "text": "#fffef0",
        "textMuted": "#cac59a",
        "primary": "#ffe600",
        "primaryHover": "#fff04a",
        "primaryActive": "#dbbf00",
        "border": "#4a4523",
        "success": "#65d58a",
        "warn": "#ffd84a",
        "danger": "#ff6a70",
        "selectionBg": "#3a3515",
        "selectionText": "#111111",
        "focusRing": "#fff389",
        "tableHeaderBg": "#26230f",
        "tableRowAlt": "#161408",
        "shadowColor": "rgba(0, 0, 0, 0.45)",
    },
    "light_dark_red": {
        **_BASELINE_TOKENS,
        "bg0": "#f4f5f8",
        "bg1": "#ebeef3",
        "bg2": "#e2e6ee",
        "text": "#1f2230",
        "textMuted": "#5b6478",
        "primary": "#8f1d2f",
        "primaryHover": "#a62a3f",
        "primaryActive": "#761324",
        "border": "#bcc4d3",
        "success": "#2f8f5f",
        "warn": "#b8862a",
        "danger": "#b7354c",
        "selectionBg": "#f0dbe0",
        "selectionText": "#1f2230",
        "focusRing": "#b2495a",
        "tableHeaderBg": "#dbe1eb",
        "tableRowAlt": "#edf1f7",
        "shadowColor": "rgba(20, 30, 50, 0.16)",
    },
    "light_dark_green": {
        **_BASELINE_TOKENS,
        "bg0": "#f2f6f4",
        "bg1": "#e8efea",
        "bg2": "#dfe8e3",
        "text": "#1d2b24",
        "textMuted": "#576c62",
        "primary": "#1f6a46",
        "primaryHover": "#2b7f58",
        "primaryActive": "#18553a",
        "border": "#b8cbc0",
        "success": "#2a8a5c",
        "warn": "#b18635",
        "danger": "#b53f52",
        "selectionBg": "#d9ebe1",
        "selectionText": "#1d2b24",
        "focusRing": "#4d9a72",
        "tableHeaderBg": "#d7e5dd",
        "tableRowAlt": "#edf4f0",
        "shadowColor": "rgba(20, 40, 30, 0.16)",
    },
    "light_dark_blue": {
        **_BASELINE_TOKENS,
        "bg0": "#f2f5fa",
        "bg1": "#e8edf5",
        "bg2": "#dfe6f0",
        "text": "#1b2434",
        "textMuted": "#55647d",
        "primary": "#224f8f",
        "primaryHover": "#2f62a9",
        "primaryActive": "#183f74",
        "border": "#b8c4d8",
        "success": "#2e8a6b",
        "warn": "#b48734",
        "danger": "#b53f52",
        "selectionBg": "#d9e3f3",
        "selectionText": "#1b2434",
        "focusRing": "#4f78b8",
        "tableHeaderBg": "#d7e0ee",
        "tableRowAlt": "#edf2f9",
        "shadowColor": "rgba(20, 35, 60, 0.16)",
    },
}


def get_theme_tokens(theme_name: str) -> ThemeTokens:
    key = theme_name.strip().lower()
    return dict(_THEME_TOKENS.get(key, _THEME_TOKENS["shroudkeeper"]))


def apply_tokens(qss: str, tokens: Mapping[str, str]) -> str:
    themed = qss
    for token_name, value in tokens.items():
        themed = themed.replace(f"{{{{{token_name}}}}}", value)
    return themed
